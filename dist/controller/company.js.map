{"version":3,"sources":["../../src/controller/company.js"],"names":["config","db","api","post","req","res","newCompany","name","body","url","city","state","geometry","coordinates","save","err","send","json","message","get","find","companies","findById","params","id","company","put","title","delete","remove","_id","newJob","type","pay","status","jobs","push"],"mappings":"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","file":"company.js","sourcesContent":["import mongoose   from 'mongoose';\nimport { Router } from 'express';\nimport Company    from '../models/company';\nimport Job        from '../models/job';\n\n//use this to lock down any route by putting 'authenticate' between the route path and (req, res)\nimport { authenticate } from '../middleware/authMiddleware';\n\nexport default({config, db}) => {\n  let api = Router();\n\n  //CRUD - Creaate Read Update Delete\n\n  //'/v1/company/add' - create\n  api.post('/add', authenticate, (req, res) => {\n    let newCompany = new Company();\n\n    newCompany.name     = req.body.name;\n    newCompany.url      = req.body.url;\n    newCompany.city     = req.body.city;\n    newCompany.state    = req.body.state;\n    newCompany.geometry.coordinates = req.body.geometry.coordinates;\n\n    newCompany.save(err =>{\n      if(err) {\n        res.send(err);\n      }\n      //notify the client that the company was saved successfully\n      res.json({message: 'Company saved successfully'});\n    });\n  });\n\n  //'v1/company' - Read\n  api.get('/', (req, res) => {\n    //empty {} = return all\n    Company.find({}, (err, companies) => {\n      if(err) {\n        res.send(err);\n      }\n      //send back all companies\n      res.json(companies);\n    });\n  });\n\n  //'v1/company/:id' - Read id\n  api.get('/:id', (req, res) => {\n    Company.findById(req.params.id, (err, company) =>{\n      if(err) {\n        res.send(err);\n      }\n      //send back the found comapny\n      res.json(company);\n    });\n  });\n\n  //'v1/company/:id' - Update\n  api.put('/:id', authenticate, (req, res) => {\n    Company.findById(req.params.id, (err, company) => {\n      if(err) {\n        res.send(err);\n      }\n\n      company.title = req.body.name;\n      company.save(err => {\n        if(err) {\n          res.send(err);\n        }\n        //send back a job updated success message\n        res.json({message: \"Company info updated!\"});\n      });\n    });\n  });\n\n  //'v1/company/:id' - Delete\n  api.delete(\"/:id\", authenticate, (req, res) => {\n    Company.remove({\n        _id: req.params.id\n    }, (err, company) => {\n      if(err) {\n        res.send(err);\n      }\n      //send back a job deleted success message\n      res.json({message: \"Company successfully removed!\"});\n    });\n  });\n\n  //'/v1/company/job/add/:id' - create\n  api.post('/job/add/:id', authenticate, (req, res) => {\n    Company.findById(req.params.id, (err, company) => {\n      if(err){\n        res.send(err);\n      }\n\n      let newJob  = new Job();\n      //set the new job properties\n      newJob.title    = req.body.title;\n      newJob.url      = req.body.url;\n      newJob.type     = req.body.type;\n      newJob.pay      = req.body.pay;\n      newJob.status   = req.body.status;\n      newJob.company  = company._id;\n      //save the new job\n      newJob.save(err =>{\n        if(err) {\n          res.send(err);\n        }\n        company.jobs.push(newJob);\n        company.save(err => {\n          if(err) {\n            res.send(err);\n          }\n          //notify the client that the company was saved successfully\n          res.json({message: 'Company job saved'});\n        });\n      });\n    });\n  });\n\n  //get jobs for a specific company id\n  //'/v1/company/jobs/:id'\n  api.get('/jobs/:id', (req, res) => {\n    Job.find({company: req.params.id}, (err, jobs) => {\n      if(err) {\n        res.send(err);\n      }\n      res.json(jobs);\n    });\n  });\n\n  return api;\n}\n"]}