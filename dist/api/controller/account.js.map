{"version":3,"sources":["../../../src/api/controller/account.js"],"names":["config","db","api","post","req","res","register","username","body","email","password","err","account","send","authenticate","sessioon","status","session","scope","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAmB;AAAA,MAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,MAARC,EAAQ,QAARA,EAAQ;;AAChC,MAAIC,MAAM,sBAAV;;AAEA;AACAA,MAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAClC,sBAAQC,QAAR,CAAiB,sBAAY;AAC3BC,gBAAUH,IAAII,IAAJ,CAASC;AADQ,KAAZ,CAAjB,EAEIL,IAAII,IAAJ,CAASE,QAFb,EAEuB,UAASC,GAAT,EAAcC,OAAd,EAAuB;AAC5C,UAAGD,GAAH,EAAO;AACLN,YAAIQ,IAAJ,CAASF,GAAT;AACD;;AAED,yBAASG,YAAT,CACE,OADF,EACW;AACPC,kBAAU;AADH,OADX,EAGGX,GAHH,EAGQC,GAHR,EAGa,YAAM;AACjBA,YAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,kCAArB;AACD,OALD;AAMD,KAbD;AAcD,GAfD;;AAiBA;AACAX,MAAIC,IAAJ,CAAS,QAAT,EAAmB,mBAASW,YAAT,CACjB,OADiB,EACR;AACPG,aAAS,KADF;AAEPC,WAAO;AAFA,GADQ,CAAnB;;AAMA;AACAhB,MAAIiB,GAAJ,CAAQ,SAAR,gCAAiC,UAACf,GAAD,EAAMC,GAAN,EAAc;AAC7CA,QAAIe,MAAJ;AACAf,QAAIW,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB,0BAArB;AACD,GAHD;;AAKA;AACAX,MAAIiB,GAAJ,CAAQ,KAAR,gCAA6B,UAACf,GAAD,EAAMC,GAAN,EAAc;AACzCA,QAAIW,MAAJ,CAAW,GAAX,EAAgBK,IAAhB,CAAqBjB,IAAIkB,IAAzB;AACD,GAFD;;AAIA,SAAOpB,GAAP;AACD,C","file":"account.js","sourcesContent":["import mongoose   from 'mongoose';\nimport { Router } from 'express';\nimport Account    from '../models/account';\nimport bodyParser from 'body-parser';\nimport passport   from 'passport';\nimport config     from '../../config';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nexport default ({ config, db}) => {\n  let api = Router();\n\n  //'/v1/account' - create\n  api.post('/register', (req, res) => {\n    Account.register(new Account({\n      username: req.body.email\n    }), req.body.password, function(err, account) {\n      if(err){\n        res.send(err);\n      }\n\n      passport.authenticate(\n        'local', {\n          sessioon: false\n      })(req, res, () => {\n        res.status(200).send('Successfully created new account');\n      });\n    });\n  });\n\n  //'/v1/account/login'\n  api.post('/login', passport.authenticate(\n    'local', {\n      session: false,\n      scope: []\n    }), generateAccessToken, respond);\n\n  //'/v1/account/logout'\n  api.get('/logout', authenticate, (req, res) => {\n    res.logout();\n    res.status(200).send('Successfully logged out.');\n  });\n\n  //'/v1/account/me'\n  api.get('/me', authenticate, (req, res) => {\n    res.status(200).json(req.user);\n  });\n\n  return api;\n};\n"]}